<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Aggregate Initialization - Yuanjun&#039;s Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Yuanjun&#039;s Blog"><meta name="msapplication-TileImage" content="/img/logo.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Yuanjun&#039;s Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="You have already known about list initialization introduced in C++11. But if a class inherit from another aggregate class, how do you initialize the variables in base class using list initialization?"><meta property="og:type" content="blog"><meta property="og:title" content="Aggregate Initialization"><meta property="og:url" content="https://wtffqbpl.github.io/2022/11/13/Aggregate-Initialization/"><meta property="og:site_name" content="Yuanjun&#039;s Blog"><meta property="og:description" content="You have already known about list initialization introduced in C++11. But if a class inherit from another aggregate class, how do you initialize the variables in base class using list initialization?"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://wtffqbpl.github.io/img/cpp/cpp-basics-5.jpg"><meta property="article:published_time" content="2022-11-13T10:35:17.000Z"><meta property="article:modified_time" content="2022-11-16T04:45:26.709Z"><meta property="article:author" content="Yuanjun Ren"><meta property="article:tag" content="C++17"><meta property="article:tag" content="C++20"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://wtffqbpl.github.io/img/cpp/cpp-basics-5.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://wtffqbpl.github.io/2022/11/13/Aggregate-Initialization/"},"headline":"Aggregate Initialization","image":["https://wtffqbpl.github.io/img/cpp/cpp-basics-5.jpg"],"datePublished":"2022-11-13T10:35:17.000Z","dateModified":"2022-11-16T04:45:26.709Z","author":{"@type":"Person","name":"Yuanjun Ren"},"publisher":{"@type":"Organization","name":"Yuanjun's Blog","logo":{"@type":"ImageObject","url":"https://wtffqbpl.github.io/img/logo.png"}},"description":"You have already known about list initialization introduced in C++11. But if a class inherit from another aggregate class, how do you initialize the variables in base class using list initialization?"}</script><link rel="canonical" href="https://wtffqbpl.github.io/2022/11/13/Aggregate-Initialization/"><link rel="icon" href="/img/logo.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const $tabMenu = document.querySelector(`a[href="${location.hash}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(location.hash);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.png" alt="Yuanjun&#039;s Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/wtffqbpl/wtffqbpl.github.io"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="/img/cpp/cpp-basics-5.jpg" alt="Aggregate Initialization"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-11-13T10:35:17.000Z" title="11/13/2022, 6:35:17 PM">2022-11-13</time></span><span class="level-item">Updated&nbsp;<time dateTime="2022-11-16T04:45:26.709Z" title="11/16/2022, 12:45:26 PM">2022-11-16</time></span><span class="level-item">7 minutes read (About 1080 words)</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>&nbsp;visits</span></div></div><h1 class="title is-3 is-size-4-mobile">Aggregate Initialization</h1><div class="content"><p>An aggregate is one of the following types:</p>
<ul>
<li>array type</li>
<li>class type (typically, <code>struct</code> or <code>union</code>), that has<ul>
<li>no private or protected non-static data members</li>
<li>no user-declared constructors</li>
<li>no user-provided, inherited, or explicit constructors</li>
<li>no user-declared or inherited constructors</li>
<li>no virtual, private, or protected base classes</li>
<li>no virtual member functions</li>
<li>no default member initializers</li>
</ul>
</li>
</ul>
<p>If we have a struct which has a single integer in it. We would need to do something like initialize the integer class member. If we use the <code>C++03</code> standard, we must have a constructor for this initialization. The code is as follows.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">S</span> &#123;</span><br><span class="line">  <span class="built_in">S</span>(<span class="type">int</span> s_i) : <span class="built_in">i</span>(s_i) &#123;&#125;</span><br><span class="line">  <span class="type">int</span> i;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="function">S <span class="title">s</span><span class="params">(<span class="number">1</span>)</span></span>;</span><br><span class="line">  <span class="keyword">return</span> s.i;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now the C++11, we were given the ability to do this uniform initialization syntax. So instead of doing a constructor, we can do this brace initialization syntax. And this works for however many elements you happen to have.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">S</span> &#123;</span><br><span class="line">  <span class="type">int</span> i;</span><br><span class="line">  <span class="type">float</span> f;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  S s&#123;<span class="number">1</span>, <span class="number">5.4f</span>&#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// We can see a truncation of the floating point value</span></span><br><span class="line">  <span class="comment">// 5.4 -&gt; 5 on the return statement from main here.</span></span><br><span class="line">  <span class="keyword">return</span> s.f;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Well, what happens when we introduce class hierarchy here. We have a base class. We get an error if we actually use inheritance from our struct S and that <code>there is no matching constructor for initialization of s</code>. Because we don’t have any way to initialize the base class.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">B</span> &#123;</span><br><span class="line">  <span class="type">double</span> d;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">S</span> : B &#123;</span><br><span class="line">  <span class="type">int</span> i;</span><br><span class="line">  <span class="type">float</span> f;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  S s&#123;<span class="number">1</span>, <span class="number">2.3</span>&#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Error: no matching constructor for</span></span><br><span class="line">  <span class="comment">// initialization of &#x27;S&#x27;.</span></span><br><span class="line">  <span class="keyword">return</span> s.f;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>So what C++17 is giving us is the ability to explicitly specify that we want the base class initialized also.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">B</span> &#123;</span><br><span class="line">  <span class="type">double</span> d;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">S</span> : B &#123;</span><br><span class="line">  <span class="type">int</span> i;</span><br><span class="line">  <span class="type">float</span> f;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// Here, we use the default initialization of</span></span><br><span class="line">  <span class="comment">// the members of struct B.</span></span><br><span class="line">  S s&#123;&#123;&#125;, <span class="number">1</span>, <span class="number">2.3</span>&#125;;</span><br><span class="line">  <span class="comment">// Here when we return d in base class B, we</span></span><br><span class="line">  <span class="comment">// return 0 since d is the default initialization.</span></span><br><span class="line">  std::cout &lt;&lt; <span class="built_in">int</span>(s.d) &lt;&lt; std::endl; <span class="comment">// 0</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// If we specify the value for d in base class B,</span></span><br><span class="line">  <span class="comment">// then we&#x27;ve got truncated value as we would expect.</span></span><br><span class="line">  S s2&#123;&#123;<span class="number">54.3</span>&#125;, <span class="number">1</span>, <span class="number">2.3</span>&#125;;</span><br><span class="line">  std::cout &lt;&lt; <span class="built_in">int</span>(s2.d) &lt;&lt; std::endl; <span class="comment">// 54</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>So we now have with our uniform initialization syntax a way of initializing base class objects </p>
<h2 id="Aggregate-Initialization"><a href="#Aggregate-Initialization" class="headerlink" title="Aggregate Initialization"></a>Aggregate Initialization</h2><p>Aggregate initialization, for example, an array initialize. So we could always initialize like this with a list initialization which is then going to perform aggreagte initialization. So list initialization means you have these braces. In C++20, we can now instead of the braces use parents which is direct initialization.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// aggregate initialization</span></span><br><span class="line"><span class="type">int</span> a1[]&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;</span><br><span class="line"><span class="type">int</span> a1[](<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br></pre></td></tr></table></figure>

<p>Why C++ committee do this? Because you couldn’t really perfect forward aggregates before C++20, that just wasn’t possible. Now you can implement emplace_back so now you can in-place aggregates in C++20. The other thing you can now do which is a little bit more like rare. You couldn’t really do aggregate initialization inside a macro because if you had inside the macro if you have curlies and then you have a comma in there the compiler would think that that’s then the next macro argument after the comma and then the puzzle will just explode. Now you can use parents so that actually compiles and now works since C++20.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">A</span> &#123;</span><br><span class="line">  <span class="type">int</span> i;</span><br><span class="line">  <span class="type">bool</span> b;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  std::vector&lt;A&gt; v;</span><br><span class="line">  v.<span class="built_in">emplace_back</span>(<span class="number">42</span>, <span class="literal">true</span>); <span class="comment">// works since C++20</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Aggregate-init-inside-a-macro"><a href="#Aggregate-init-inside-a-macro" class="headerlink" title="Aggregate init inside a macro."></a>Aggregate init inside a macro.</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">A</span> &#123;</span><br><span class="line">  <span class="type">int</span> i;</span><br><span class="line">  <span class="type">bool</span> b;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="type">bool</span> <span class="title">isValid</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> i == <span class="number">42</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// Error: parser explodes :(</span></span><br><span class="line">  <span class="built_in">assert</span>(A&#123;<span class="number">42</span>, <span class="literal">true</span>&#125;.<span class="built_in">isValid</span>());</span><br><span class="line">  <span class="comment">// OK since C++20</span></span><br><span class="line">  <span class="built_in">assert</span>(<span class="built_in">A</span>(<span class="number">42</span>, <span class="literal">true</span>).<span class="built_in">isValid</span>());</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>So introduce this feature, we solved two problems.</p>
<h2 id="Narrowing-conversions"><a href="#Narrowing-conversions" class="headerlink" title="Narrowing conversions."></a>Narrowing conversions.</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">A</span> &#123;</span><br><span class="line">  <span class="type">int</span> i;</span><br><span class="line">  <span class="type">bool</span> b;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Error: narrowing conversion from &#x27;double&#x27; to &#x27;int&#x27;.</span></span><br><span class="line">A a1&#123;<span class="number">42.5</span>, <span class="literal">true</span>&#125;;</span><br><span class="line"><span class="comment">// OK</span></span><br><span class="line"><span class="function">A <span class="title">a2</span><span class="params">(<span class="number">42.5</span>, <span class="literal">true</span>)</span></span>;</span><br></pre></td></tr></table></figure>

<p>Brace elision.</p>
<p>If you have a brace elision like that you have a nested aggregate. So you have an aggregate inside an aggregate. If you do curlys, you get brace solutions so you can basically do the flat right out the flat initializations and it’s going to recurse into the sub aggregates. But the parents doesn’t work.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">A</span> &#123;</span><br><span class="line">  <span class="type">int</span> i;</span><br><span class="line">  <span class="type">bool</span> b;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">AA</span> &#123;</span><br><span class="line">  A a1;</span><br><span class="line">  A a2;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">AA aa1&#123;<span class="number">42</span>, <span class="literal">true</span>, <span class="number">43</span>, <span class="literal">false</span>&#125;; <span class="comment">// OK</span></span><br><span class="line"><span class="function">AA <span class="title">aa1</span><span class="params">(<span class="number">42</span>, <span class="literal">true</span>, <span class="number">43</span>, <span class="literal">false</span>)</span></span>; <span class="comment">// Error</span></span><br></pre></td></tr></table></figure>

<h2 id="Lifetime-Extension-of-Temporary-Object"><a href="#Lifetime-Extension-of-Temporary-Object" class="headerlink" title="Lifetime Extension of Temporary Object"></a>Lifetime Extension of Temporary Object</h2><p>You have a reference member, so what list initialization is going to do if you do aggregation via list initialization, it’s going to actually extend the lifetime of the reference if you initialize it with a temporary.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">A</span> &#123;</span><br><span class="line">  <span class="type">int</span>&amp;&amp; i;</span><br><span class="line">  <span class="type">bool</span> b;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  A a1&#123;<span class="number">42</span>, <span class="literal">true</span>&#125;; <span class="comment">// OK</span></span><br><span class="line">  <span class="keyword">return</span> a1.i; <span class="comment">// returns 42</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// If you use the parents, then you got</span></span><br><span class="line">  <span class="comment">// Dangling reference error, and then you</span></span><br><span class="line">  <span class="comment">// got a behavior and that is going to be</span></span><br><span class="line">  <span class="comment">// sad.</span></span><br><span class="line">  <span class="function">A <span class="title">a2</span><span class="params">(<span class="number">42</span>, <span class="literal">true</span>)</span></span>; <span class="comment">// Dangling reference</span></span><br><span class="line">  <span class="keyword">return</span> a2.i; <span class="comment">// Undefined behavior</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Another case.<br>If you have a <code>struct A</code>, which has one aggregation member, and have a non-aggregation member since <code>struct C</code> has a user-defined constructor. Then if you want to initialize this aggregate with a list initialization by just initialization both of these members. That works with curlys and works with parens.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">C</span> &#123;</span><br><span class="line">  <span class="function"><span class="keyword">explicit</span> <span class="title">C</span><span class="params">()</span> </span>= <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">A</span> &#123;</span><br><span class="line">  <span class="type">int</span> i;</span><br><span class="line">  C c; <span class="comment">// This is not aggregation member</span></span><br><span class="line">       <span class="comment">// since struct C has a user-defined</span></span><br><span class="line">       <span class="comment">// constructor.</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> a1 = A&#123;<span class="number">42</span>, C&#123;&#125;&#125;; <span class="comment">// OK</span></span><br><span class="line"><span class="keyword">auto</span> a2 = A&#123;<span class="number">42</span>, <span class="built_in">C</span>()&#125;; <span class="comment">// OK</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Error: can&#x27;t call explicit ctor.</span></span><br><span class="line"><span class="keyword">auto</span> a3 = A&#123;<span class="number">42</span>&#125;;</span><br><span class="line"><span class="keyword">auto</span> a4 = <span class="built_in">A</span>(<span class="number">42</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Error: can&#x27;t call explicit ctor.</span></span><br><span class="line"><span class="keyword">auto</span> a5 = A&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// OK: value initialization,</span></span><br><span class="line"><span class="comment">// NOT aggregate initialization!</span></span><br><span class="line"><span class="keyword">auto</span> a6 = <span class="built_in">A</span>();</span><br></pre></td></tr></table></figure>

<p><code>auto a5 = A&#123;&#125;;</code> is wrong, because you get an implicit initialized aggregate member, and if you do that with curlies, it is going to copy initialize that aggregate member as if by copy initialization from an empty braced init list. And copy initialization doesn’t work with explicit constructors, so you get a compiler error.</p>
<p><code>auto a6 = A();</code> is OK. This is actually has a meaning, it has the meaning of <code>value initialization</code> since C++03, which is going to do zero initialization. This has the same meaning as before, so that’s going to just zero out the struct, and that’s fine.</p>
<h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><ul>
<li><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=flLNi0aejew">Direct Aggregate Initialization - Timur Doumler</a></li>
<li><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=qMqWoT016cA">C++17’s Aggregate Initializations</a></li>
<li><a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/language/aggregate_initialization">Aggregate Initialization</a></li>
</ul>
</div><div class="article-licensing box"><div class="licensing-title"><p>Aggregate Initialization</p><p><a href="https://wtffqbpl.github.io/2022/11/13/Aggregate-Initialization/">https://wtffqbpl.github.io/2022/11/13/Aggregate-Initialization/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Yuanjun Ren</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2022-11-13</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2022-11-16</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/C-17/">C++17</a><a class="link-muted mr-2" rel="tag" href="/tags/C-20/">C++20</a></div><!--!--></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">Like this article? Support the author with</h3><div class="buttons is-centered"><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>Alipay</span><span class="qrcode"><img src="/img/alipay-qrcode.jpg" alt="Alipay"></span></a><a class="button donate" href="/" target="_blank" rel="noopener" data-type="buymeacoffee"><span class="icon is-small"><i class="fas fa-coffee"></i></span><span>Buy me a coffee</span></a><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>Wechat</span><span class="qrcode"><img src="/img/wechat-qrcode.jpg" alt="Wechat"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2022/11/14/C-learning-lists/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">C++ learning lists</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2022/11/13/C-Lambda-Idioms/"><span class="level-item">C++ Lambda Idioms</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div id="comment-container"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js"></script><script>var gitalk = new Gitalk({
            id: "76ce43b8788847367688a46586ccad89",
            repo: "wtffqbpl.github.io",
            owner: "wtffqbpl",
            clientID: "91ed89a1c2b6427b0731",
            clientSecret: "133fc04688d9a06b6d46e34f1e40909bd5780033",
            admin: ["wtffqbpl"],
            createIssueManually: false,
            distractionFreeMode: false,
            perPage: 20,
            pagerDirection: "last",
            
            
            enableHotKey: true,
            
        })
        gitalk.render('comment-container')</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/profile.jpg" alt="Yuanjun Ren"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Yuanjun Ren</p><p class="is-size-6 is-block">C++ Programmer</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Xi&#039;an/China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">12</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">13</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/wtffqbpl" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/wtffqbpl"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Linkedin" href="https://www.linkedin.com/in/yuanjun-ren-5a7949bb"><i class="fab fa-linkedin"></i></a></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#Aggregate-Initialization"><span class="level-left"><span class="level-item">1.1</span><span class="level-item">Aggregate Initialization</span></span></a></li><li><a class="level is-mobile" href="#Aggregate-init-inside-a-macro"><span class="level-left"><span class="level-item">1.2</span><span class="level-item">Aggregate init inside a macro.</span></span></a></li><li><a class="level is-mobile" href="#Narrowing-conversions"><span class="level-left"><span class="level-item">1.3</span><span class="level-item">Narrowing conversions.</span></span></a></li><li><a class="level is-mobile" href="#Lifetime-Extension-of-Temporary-Object"><span class="level-left"><span class="level-item">1.4</span><span class="level-item">Lifetime Extension of Temporary Object</span></span></a></li></ul><li><a class="level is-mobile" href="#References"><span class="level-left"><span class="level-item">2</span><span class="level-item">References</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><!--!--><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/C/"><span class="tag">C++</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/C-14/"><span class="tag">C++14</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/C-17/"><span class="tag">C++17</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/C-20/"><span class="tag">C++20</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CMake/"><span class="tag">CMake</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CUB/"><span class="tag">CUB</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CUDA/"><span class="tag">CUDA</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hexo/"><span class="tag">Hexo</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/LLVM/"><span class="tag">LLVM</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Lambda/"><span class="tag">Lambda</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Meta-Programming/"><span class="tag">Meta-Programming</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/STL/"><span class="tag">STL</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Thrust/"><span class="tag">Thrust</span><span class="tag">2</span></a></div></div></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-12-06T15:16:26.000Z">2022-12-06</time></p><p class="title"><a href="/2022/12/06/Thrust-Archiecture-Overview/">Thrust Archiecture Overview</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-11-22T07:14:42.000Z">2022-11-22</time></p><p class="title"><a href="/2022/11/22/CUDA-Thrust-Introduction/">CUDA Thrust Introduction</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-11-16T16:34:10.000Z">2022-11-17</time></p><p class="title"><a href="/2022/11/17/C-STL-Overview/">C++ STL Overview</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-11-13T18:18:06.000Z">2022-11-14</time></p><p class="title"><a href="/2022/11/14/C-learning-lists/">C++ learning lists</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-11-13T10:35:17.000Z">2022-11-13</time></p><p class="title"><a href="/2022/11/13/Aggregate-Initialization/">Aggregate Initialization</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2022/12/"><span class="level-start"><span class="level-item">December 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/11/"><span class="level-start"><span class="level-item">November 2022</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/10/"><span class="level-start"><span class="level-item">October 2022</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe for updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://coderchenlin.github.io/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Lin&#039;s Blog</span></span><span class="level-right"><span class="level-item tag">coderchenlin.github.io</span></span></a></li></ul></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.png" alt="Yuanjun&#039;s Blog" height="28"></a><p class="is-size-7"><span>&copy; 2023 Yuanjun Ren</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">Visited by <span id="busuanzi_value_site_uv">0</span> users</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/wtffqbpl/wtffqbpl.github.io"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><style>.searchbox .searchbox-body { background: white; }</style><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"><gcse:searchresults-only></gcse:searchresults-only></div></div><script>(function() {
            var cx = 'd795d66993bb247ae';
            var gcse = document.createElement('script');
            gcse.type = 'text/javascript';
            gcse.async = true;
            gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(gcse, s);
        })();</script></div><script src="/js/google_cse.js"></script></body></html>